---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# CamaraBR <img src="inst/figures/CamaraBR-logo.png" width="240px" align="right" /> 

[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
  [![Build Status](https://travis-ci.org/danielmarcelino/CamaraBR.svg?branch=master)](https://travis-ci.org/danielmarcelino/CamaraBR)
![CRAN Version](https://www.r-pkg.org/badges/version/CamaraBR)
![License](https://img.shields.io/badge/license-MIT-blueviolet.svg?style=flat)


## R package for accessing the Brazilian Chamber of Deputies RESTful API

## Installation

To get the current development version from Github:

```{r, eval=FALSE}
## install devtools package if it's not already
if (!requireNamespace("devtools", quietly = TRUE)) {
  install.packages("devtools")
}
## install dev version of CamaraBR from github
devtools::install_github("danielmarcelino/CamaraBR")
## load CamaraBR package
library(CamaraBR)
```

## Usage

### Downloading proposal details 
```{r, eval=FALSE}
require(purrr)
require(progress);

anos = 1988:2020

barra <- progress_bar$new(total = length(anos), 
                          format = "[:bar] :percent eta: :eta")
      

proposals <- purrr::map_df(anos, ~{
                           barra$tick()
                           loadCamaraProposals(.x)
                           })


proposals %>% count(type_bill)

# fwrite(proposals, file = "data/proposals.txt")

# save(proposals, file = "data/proposals.rda")
```



### Downloading legislator rollcall vote details 
```{r, eval=FALSE}
require(purrr)
require(progress);

anos = 2003:2020

barra <- progress_bar$new(total = length(anos), 
                          format = "[:bar] :percent eta: :eta")

 rollcall <- purrr::map_df(anos, ~{
                           barra$tick()
                           loadVotacoesCamara(.x)
                          })


rollcall %>% count(legislator_party)
```


### Downloading rollcall vote orientations

```{r, eval=FALSE}
require(purrr)

anos = 2003:2020

orientation <- purrr::map_df(anos, ~{
                           loadVotacoesOrientacoesCamara(.x)
                           })


orientation %>% count(sigla_orgao)


orientation %>% count(sigla_bancada)
```


### Build a rollcall dataset

```{r, eval=FALSE}
# data1990 <- buildRollcallDataset(year = 1995)

data2020 <- buildRollcallDataset(year = 2020)

```


### Transform the dataset for analysis

```{r, eval=FALSE}
siglaTipo = c("MPV", "MSC", "PDC", "PDL", "PEC", "PL", "PLS", "PLN", "PLP", "REC", "REQ")


# Limpando a base
base <- transformVotes(data2020, filter = TRUE)


# Votações válidas no ano para o nosso cálculo
base %>%
  # filter(!is.na(GOV_orientation)) %>%
  distinct(rollcall_id) %>%
  nrow()



base %>%
  filter(legislator_vote %in% c("Nao", "Obstrucao","Sim")) %>%
  filter(!is.na(legislator_vote)) %>%
  count(GOV_orientation)

```


## Governismo geral
```{r}
# base %>% group_by(legislator_party) %>% summarise(n=n()) %>% data.frame()

## Governismo geral
(governismo_geral <- base %>%
  group_by(rollcall_id) %>%
  summarise(governismo = mean(governismo, na.rm=T)) %>%
  summarise(governismo = mean(governismo, na.rm=T)))
```



## Governismo por partido

```{r}
# Por partido
governismo_partido <- base %>%
  group_by(rollcall_id, legislator_party) %>%
  summarise(soma = sum(governismo, na.rm=TRUE),
            nao = sum(abs(-1 + governismo)),
            governismo = mean(governismo, na.rm=TRUE),
            freq = n()) %>%
# filter(legislator_party %in% c("PT", "PSDB", "PMDB","MDB", "PSL", "PP","PR","PSD", "DEM")) %>%
  group_by(legislator_party) %>%
  summarise(governismo = mean(governismo, na.rm=TRUE),
            soma = sum(soma, na.rm=TRUE),
            nao = sum(nao))

# governismo_partido %>% arrange(governismo) %>% data.frame()


governismo_partido %>%
  arrange(governismo) %>%
  summarize(mu = mean(governismo, na.rm=T),
            sd = sd(governismo, na.rm=T))
```





